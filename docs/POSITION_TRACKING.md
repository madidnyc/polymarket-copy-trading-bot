# Position Tracking System

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –≤—ã –ø–æ–ø–æ–ª–Ω—è–µ—Ç–µ —Å–≤–æ–π —Å—á–µ—Ç –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –ø–æ–∑–∏—Ü–∏–∏, –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ –±–æ—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–¥–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ä–∞—Å—á–µ—Ç –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–º –±–∞–ª–∞–Ω—Å–µ, –∞ –Ω–µ –Ω–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫—É–ø–ª–µ–Ω–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:

1. –£ –≤–∞—Å –±–∞–ª–∞–Ω—Å $100, —É —Ç—Ä–µ–π–¥–µ—Ä–∞ $500
2. –¢—Ä–µ–π–¥–µ—Ä –ø–æ–∫—É–ø–∞–µ—Ç –Ω–∞ $50 ‚Üí –≤—ã –ø–æ–∫—É–ø–∞–µ—Ç–µ –Ω–∞ $10 (–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ 20%)
3. **–í—ã –ø–æ–ø–æ–ª–Ω—è–µ—Ç–µ –±–∞–ª–∞–Ω—Å –¥–æ $500**
4. –¢—Ä–µ–π–¥–µ—Ä –ø—Ä–æ–¥–∞–µ—Ç 50% –ø–æ–∑–∏—Ü–∏–∏
5. **–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞**: –ø—Ä–æ–¥–∞—Å—Ç 50% –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
6. **–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞**: –ø—Ä–æ–¥–∞—Å—Ç 50% –æ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

## –†–µ—à–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–∫—É–ø–æ–∫ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

#### 1. –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ (BUY)

- –ë–æ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø–æ–ª–µ `myBoughtSize`
- –≠—Ç–æ —á–∏—Å–ª–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö MongoDB –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

#### 2. –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ (SELL)

- –ë–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∫—É–ø–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ asset/conditionId
- –°—É–º–º–∏—Ä—É–µ—Ç –≤—Å–µ –∫—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (`myBoughtSize`)
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–¥–∞–µ—Ç —Ç—Ä–µ–π–¥–µ—Ä
- **–ü—Ä–∏–º–µ–Ω—è–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫—É–ø–ª–µ–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–∞–º**, –∞ –Ω–µ –∫ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
- –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –ø–æ–∫—É–ø–∫–∏:
    - –ï—Å–ª–∏ –ø—Ä–æ–¥–∞–Ω–æ ‚â•99% ‚Üí –æ—á–∏—â–∞–µ—Ç tracking –ø–æ–ª–Ω–æ—Å—Ç—å—é
    - –ï—Å–ª–∏ –ø—Ä–æ–¥–∞–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ ‚Üí –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç `myBoughtSize` –¥–ª—è –≤—Å–µ—Ö –ø–æ–∫—É–ø–æ–∫

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (`userHistory.ts`)

```typescript
myBoughtSize: { type: Number, required: false } // Tracks actual tokens we bought
```

### 2. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`User.ts`)

```typescript
myBoughtSize?: number; // Tracks actual tokens we bought
```

### 3. –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏ (`postOrder.ts`)

- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç `totalBoughtTokens` –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –±–∞–∑—É: `{ myBoughtSize: totalBoughtTokens }`
- –õ–æ–≥–∏—Ä—É–µ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏: `üìù Tracked purchase: X.XX tokens`

### 4. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ (`postOrder.ts`)

- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∫—É–ø–∫–∏:
    ```typescript
    const previousBuys = await UserActivity.find({
        asset: trade.asset,
        conditionId: trade.conditionId,
        side: 'BUY',
        bot: true,
        myBoughtSize: { $exists: true, $gt: 0 },
    });
    ```
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤, –∞ –Ω–µ –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
- –û–±–Ω–æ–≤–ª—è–µ—Ç tracking –ø–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏**: –ü—Ä–æ–¥–∞–∂–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫—É–ø–ª–µ–Ω–Ω–æ–º—É
2. ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è**: –ú–æ–∂–Ω–æ –ø–æ–ø–æ–ª–Ω—è—Ç—å –±–∞–ª–∞–Ω—Å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è
3. ‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤, –∞ –Ω–µ —Ä–∞—Å—á–µ—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞
4. ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –í–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö, —Å–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
5. ‚úÖ **Fallback**: –ï—Å–ª–∏ –Ω–µ—Ç tracked purchases, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ:

```
‚úÖ Bought $10.00 at $0.52 (19.23 tokens)
üìù Tracked purchase: 19.23 tokens for future sell calculations
```

### –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ:

```
üìä Found 2 previous purchases: 35.45 tokens bought
Calculating from tracked purchases: 35.45 √ó 50.00% = 17.72 tokens
‚úÖ Sold 17.72 tokens at $0.55
üìù Updated purchase tracking (sold 50.0% of tracked position)
```

### –ü—Ä–∏ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–¥–∞–∂–µ:

```
üßπ Cleared purchase tracking (sold 100.0% of position)
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- **–°—Ç–∞—Ä—ã–µ –ø–æ–∑–∏—Ü–∏–∏** (–±–µ–∑ `myBoughtSize`): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (—Ä–∞—Å—á–µ—Ç –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏)
- **–ù–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö: `‚ö†Ô∏è No tracked purchases found, using current position`

## –ú–∏–≥—Ä–∞—Ü–∏—è

–ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–æ–π
- –ù–æ–≤—ã–µ –ø–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω—É—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ–π–¥—É—Ç –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã:

1. –ö—É–ø–∏—Ç–µ –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–µ X
2. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –¥–æ Y (Y > X)
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø—Ä–æ–¥–∞–∂–∏ —Ç—Ä–µ–π–¥–µ—Ä–æ–º
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å "üìä Found N previous purchases"
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–¥–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤

## FAQ

**Q: –ß—Ç–æ –µ—Å–ª–∏ —è –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–¥–∞–º —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏?**
A: –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–¥–µ–ª–∫–∏ –±–æ—Ç–∞. –†—É—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è.

**Q: –ß—Ç–æ –µ—Å–ª–∏ —Ç—Ä–µ–π–¥–µ—Ä –∑–∞–∫—Ä—ã–ª –≤—Å—é –ø–æ–∑–∏—Ü–∏—é?**
A: –ë–æ—Ç –ø—Ä–æ–¥–∞—Å—Ç –≤—Å—é –≤–∞—à—É —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç tracking).

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é?**
A: –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –µ—Å–ª–∏ tracking –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
